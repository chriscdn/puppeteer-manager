var e=require("puppeteer"),r=require("@chriscdn/promise-semaphore");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=/*#__PURE__*/t(e);function n(e,r){try{var t=e()}catch(e){return r(!0,e)}return t&&t.then?t.then(r.bind(null,!1),r.bind(null,!0)):r(!1,t)}var i={pipe:!0,args:["--no-sandbox","--disable-setuid-sandbox","--use-gl=desktop","--font-render-hinting=none"],dumpio:!0,acceptInsecureCerts:!0},u=/*#__PURE__*/function(){function e(e){var t=void 0===e?{}:e,o=t.puppeteerOptions,n=void 0===o?i:o,u=t.pageLimit,s=void 0===u?4:u,p=t.timeout,a=void 0===p?3e4:p;this.puppeteerOptions=void 0,this._browser=void 0,this.timeoutId=void 0,this.timeout=void 0,this.newPageSemaphore=void 0,this.openCloseSemaphore=void 0,this.puppeteerOptions=n,this._browser=null,this.timeoutId=void 0,this.timeout=a,this.newPageSemaphore=new r.Semaphore(s),this.openCloseSemaphore=new r.Semaphore}var t,u,s=e.prototype;return s.browser=function(){try{var e=function(){return r.tap(),r._browser},r=this,t=function(){if(null===r._browser)return console.log("Puppeteer Started"),Promise.resolve(o.default.launch(r.puppeteerOptions)).then(function(e){r._browser=e})}();return Promise.resolve(t&&t.then?t.then(e):e())}catch(e){return Promise.reject(e)}},s.tap=function(){clearTimeout(this.timeoutId),this.timeoutId=setTimeout(this.closeBrowser.bind(this),this.timeout)},s.closeBrowser=function(){try{var e=this,r=n(function(){return Promise.resolve(e.openCloseSemaphore.acquire()).then(function(){function r(r){var o=function(){if(t&&r<=1){var o=e._browser;return e._browser=null,Promise.resolve(o.close()).then(function(){console.log("Puppeteer Closed")})}e.tap()}();if(o&&o.then)return o.then(function(){})}var t=e.isBrowserOpen;return t?Promise.resolve(e.pageCount()).then(r):r(t)})},function(r,t){if(e.openCloseSemaphore.release(),r)throw t;return t});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},s.newPage=function(){try{var e=this;return Promise.resolve(n(function(){return Promise.resolve(e.newPageSemaphore.acquire()).then(function(){return Promise.resolve(e.openCloseSemaphore.acquire()).then(function(){return Promise.resolve(e.browser()).then(function(r){return Promise.resolve(r.newPage()).then(function(r){return r.on("close",function(){return e.newPageSemaphore.release()}),r})})})})},function(r,t){if(e.openCloseSemaphore.release(),r)throw t;return t}))}catch(e){return Promise.reject(e)}},s.pageCount=function(){try{return this.isBrowserOpen?Promise.resolve(this._browser.pages()).then(function(e){return e.length}):Promise.resolve(0)}catch(e){return Promise.reject(e)}},t=e,(u=[{key:"isBrowserOpen",get:function(){return Boolean(this._browser)}}])&&function(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,r){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key))?n:String(n),o)}var n}(t.prototype,u),Object.defineProperty(t,"prototype",{writable:!1}),e}();Object.defineProperty(exports,"puppeteer",{enumerable:!0,get:function(){return o.default}}),exports.PuppeteerManager=u,Object.keys(e).forEach(function(r){"default"===r||exports.hasOwnProperty(r)||Object.defineProperty(exports,r,{enumerable:!0,get:function(){return e[r]}})});
//# sourceMappingURL=puppeteer-manager.cjs.map
