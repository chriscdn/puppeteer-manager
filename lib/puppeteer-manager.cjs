var e=require("puppeteer"),r=require("@chriscdn/promise-semaphore");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=/*#__PURE__*/t(e),n=/*#__PURE__*/t(r);function i(e,r){try{var t=e()}catch(e){return r(!0,e)}return t&&t.then?t.then(r.bind(null,!1),r.bind(null,!0)):r(!1,t)}var u={pipe:!0,args:["--no-sandbox","--disable-setuid-sandbox","--use-gl=desktop","--font-render-hinting=none"],dumpio:!0,ignoreHTTPSErrors:!0},s=/*#__PURE__*/function(){function e(e){var r=void 0===e?{}:e,t=r.puppeteerOptions,o=void 0===t?u:t,i=r.pageLimit,s=void 0===i?4:i,a=r.timeout,p=void 0===a?3e4:a;this.puppeteerOptions=void 0,this._browser=void 0,this.timeoutId=void 0,this.timeout=void 0,this.newPageSemaphore=void 0,this.openCloseSemaphore=void 0,this.puppeteerOptions=o,this._browser=null,this.timeoutId=void 0,this.timeout=p,this.newPageSemaphore=new n.default(s),this.openCloseSemaphore=new n.default}var r,t,s=e.prototype;return s.browser=function(){try{var e=function(){return r.tap(),r._browser},r=this,t=function(){if(null===r._browser)return console.log("Puppeteer Started"),Promise.resolve(o.default.launch(r.puppeteerOptions)).then(function(e){r._browser=e})}();return Promise.resolve(t&&t.then?t.then(e):e())}catch(e){return Promise.reject(e)}},s.tap=function(){clearTimeout(this.timeoutId),this.timeoutId=setTimeout(this.closeBrowser.bind(this),this.timeout)},s.closeBrowser=function(){try{var e=this,r=i(function(){return Promise.resolve(e.openCloseSemaphore.acquire()).then(function(){function r(r){var o=function(){if(t&&r<=1){var o=e._browser;return e._browser=null,Promise.resolve(o.close()).then(function(){console.log("Puppeteer Closed")})}e.tap()}();if(o&&o.then)return o.then(function(){})}var t=e.isBrowserOpen;return t?Promise.resolve(e.pageCount()).then(r):r(t)})},function(r,t){if(e.openCloseSemaphore.release(),r)throw t;return t});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},s.newPage=function(){try{var e=this;return Promise.resolve(i(function(){return Promise.resolve(e.newPageSemaphore.acquire()).then(function(){return Promise.resolve(e.openCloseSemaphore.acquire()).then(function(){return Promise.resolve(e.browser()).then(function(r){return Promise.resolve(r.newPage()).then(function(r){return r.on("close",function(){return e.newPageSemaphore.release()}),r})})})})},function(r,t){if(e.openCloseSemaphore.release(),r)throw t;return t}))}catch(e){return Promise.reject(e)}},s.pageCount=function(){try{return this.isBrowserOpen?Promise.resolve(this._browser.pages()).then(function(e){return e.length}):Promise.resolve(0)}catch(e){return Promise.reject(e)}},r=e,(t=[{key:"isBrowserOpen",get:function(){return Boolean(this._browser)}}])&&function(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,r){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key))?n:String(n),o)}var n}(r.prototype,t),Object.defineProperty(r,"prototype",{writable:!1}),e}();Object.defineProperty(exports,"puppeteer",{enumerable:!0,get:function(){return o.default}}),exports.PuppeteerManager=s;
//# sourceMappingURL=puppeteer-manager.cjs.map
