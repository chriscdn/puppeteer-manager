import e from"puppeteer";import r from"@chriscdn/promise-semaphore";function t(e,r){try{var t=e()}catch(e){return r(!0,e)}return t&&t.then?t.then(r.bind(null,!1),r.bind(null,!0)):r(!1,t)}var o={pipe:!0,args:["--no-sandbox","--disable-setuid-sandbox","--use-gl=desktop","--font-render-hinting=none"],dumpio:!0,ignoreHTTPSErrors:!0},n=/*#__PURE__*/function(){function n(e){var t=void 0===e?{}:e,n=t.puppeteerOptions,i=void 0===n?o:n,s=t.pageLimit,u=void 0===s?4:s,p=t.timeout,a=void 0===p?3e4:p;this.puppeteerOptions=void 0,this._browser=void 0,this.timeoutId=void 0,this.timeout=void 0,this.newPageSemaphore=void 0,this.openCloseSemaphore=void 0,this.puppeteerOptions=i,this._browser=null,this.timeoutId=void 0,this.timeout=a,this.newPageSemaphore=new r(u),this.openCloseSemaphore=new r}var i,s,u=n.prototype;return u.browser=function(){try{var r=function(){return t.tap(),t._browser},t=this,o=function(){if(null===t._browser)return console.log("Puppeteer Started"),Promise.resolve(e.launch(t.puppeteerOptions)).then(function(e){t._browser=e})}();return Promise.resolve(o&&o.then?o.then(r):r())}catch(e){return Promise.reject(e)}},u.tap=function(){clearTimeout(this.timeoutId),this.timeoutId=setTimeout(this.closeBrowser.bind(this),this.timeout)},u.closeBrowser=function(){try{var e=this,r=t(function(){return Promise.resolve(e.openCloseSemaphore.acquire()).then(function(){function r(r){var o=function(){if(t&&r<=1){var o=e._browser;return e._browser=null,Promise.resolve(o.close()).then(function(){console.log("Puppeteer Closed")})}e.tap()}();if(o&&o.then)return o.then(function(){})}var t=e.isBrowserOpen;return t?Promise.resolve(e.pageCount()).then(r):r(t)})},function(r,t){if(e.openCloseSemaphore.release(),r)throw t;return t});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},u.newPage=function(){try{var e=this;return Promise.resolve(t(function(){return Promise.resolve(e.newPageSemaphore.acquire()).then(function(){return Promise.resolve(e.openCloseSemaphore.acquire()).then(function(){return Promise.resolve(e.browser()).then(function(r){return Promise.resolve(r.newPage()).then(function(r){return r.on("close",function(){return e.newPageSemaphore.release()}),r})})})})},function(r,t){if(e.openCloseSemaphore.release(),r)throw t;return t}))}catch(e){return Promise.reject(e)}},u.pageCount=function(){try{return this.isBrowserOpen?Promise.resolve(this._browser.pages()).then(function(e){return e.length}):Promise.resolve(0)}catch(e){return Promise.reject(e)}},i=n,(s=[{key:"isBrowserOpen",get:function(){return Boolean(this._browser)}}])&&function(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,"symbol"==typeof(n=function(e,r){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key))?n:String(n),o)}var n}(i.prototype,s),Object.defineProperty(i,"prototype",{writable:!1}),n}();export{n as default};
//# sourceMappingURL=puppeteer-manager.module.js.map
